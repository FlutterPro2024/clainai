<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3B82F6">
    <meta name="description" content="ูุณุงุนุฏ ุฐูู ุนุฑุจู ูุชูุงูู ููุญุงุฏุซุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ClainAI">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/icons/icon-152x152.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClainAI - ุงูุฐูู ุงูููุงุฆู</title>
    <link rel="stylesheet" href="/static/css/style-v2.css?v=4">
</head>
<body>
    <div class="container">
        <!-- ุงูููุฏุฑ -->
        <div class="chat-header">
            <div class="chat-title">ูุญุงุฏุซุฉ ุฐููุฉ ูุซู ChatGPT ุชูุงูุงู</div>
            <div class="chat-subtitle">ClainAI - ุงููุณุงุนุฏ ุงูุฐูู</div>
            <div class="user-badge" id="userBadge">๐ค ุฌุงุฑู ุงูุชุญููู...</div>
        </div>

        <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู -->
        <div class="control-buttons">
            <button class="control-btn clear-btn" onclick="window.clainai.clearChat()">
                ๐๏ธ ูุณุญ ุงููุญุงุฏุซุฉ
            </button>
            <button class="control-btn logout-btn" onclick="window.clainai.logout()">
                ๐ช ุชุณุฌูู ุงูุฎุฑูุฌ
            </button>
        </div>

        <!-- ุญุงููุฉ ุงููุญุงุฏุซุฉ -->
        <div class="messages-container" id="chatContainer">
            <div class="message assistant-message">
                <div class="message-bubble">
                    ๐ ูุฑุญุจุงู ุจู ูู ClainAI! ุฃูุง ูุณุงุนุฏู ุงูุฐูู. ููู ูููููู ูุณุงุนุฏุชู ุงููููุ
                </div>
                <div class="message-time" id="welcomeTime"></div>
            </div>
        </div>

        <!-- ููุทูุฉ ุงูุฅุฏุฎุงู -->
        <div class="input-area">
            <!-- ุฒุฑ ุงูุฒุงุฆุฏ ููุงุฆูุฉ ุงููุฑููุงุช -->
            <div class="input-row">
                <button class="plus-button" id="plusButton">
                    <span>+</span>
                </button>

                <div class="attachments-menu" id="attachmentsMenu">
                    <div class="attachment-item" onclick="showNews()">
                        <span>๐ฐ</span>
                        <span>ุฃุฎุจุงุฑ ุงูููู</span>
                    </div>
                    <div class="attachment-item" onclick="uploadFiles()">
                        <span>๐</span>
                        <span>ุฑูุน ูููุงุช</span>
                    </div>
                    <div class="attachment-item" onclick="uploadImages()">
                        <span>๐ผ๏ธ</span>
                        <span>ุตูุฑ</span>
                    </div>
                </div>

                <input type="text" class="message-input" id="messageInput"
                       placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..." autocomplete="off">

                <button class="send-button" onclick="window.clainai.sendMessage()" id="sendButton">
                    ุฅุฑุณุงู
                </button>
            </div>
        </div>
    </div>

    <!-- ุฅุฏุฎุงู ุงูููู ุงููุฎูู -->
    <input type="file" id="fileInput" style="display: none;" multiple
           accept=".png,.jpg,.jpeg,.gif,.pdf,.txt,.doc,.docx,.zip">
    <input type="file" id="imageInput" style="display: none;" multiple
           accept=".png,.jpg,.jpeg,.gif">

    <!-- ุชุถููู ููุฏ ุงูุฌุงูุงุณูุฑูุจุช -->
    <script src="/static/js/app.js"></script>

    <script>
        // ุชููุฆุฉ ุงูููุช ุงูุชุฑุญูุจู
        document.getElementById('welcomeTime').textContent = new Date().toLocaleTimeString('ar-EG', {
            hour: '2-digit',
            minute: '2-digit'
        });

        // ุฅุฏุงุฑุฉ ุฒุฑ ุงูุฒุงุฆุฏ ูุงููุฑููุงุช
        document.addEventListener('DOMContentLoaded', function() {
            const plusButton = document.getElementById('plusButton');
            const attachmentsMenu = document.getElementById('attachmentsMenu');
            const messageInput = document.getElementById('messageInput');

            // ุฅุธูุงุฑ/ุฅุฎูุงุก ูุงุฆูุฉ ุงููุฑููุงุช
            if (plusButton && attachmentsMenu) {
                plusButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    attachmentsMenu.style.display = attachmentsMenu.style.display === 'flex' ? 'none' : 'flex';
                });

                // ุฅุฎูุงุก ุงููุงุฆูุฉ ุนูุฏ ุงูููุฑ ุฎุงุฑุฌูุง
                document.addEventListener('click', function() {
                    attachmentsMenu.style.display = 'none';
                });

                // ููุน ุฅุบูุงู ุงููุงุฆูุฉ ุนูุฏ ุงูููุฑ ุฏุงุฎููุง
                attachmentsMenu.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }

            // ุชุญุฏูุซ ูุนูููุงุช ุงููุณุชุฎุฏู
            updateUserInfo();
        });

        // ุชุญุฏูุซ ูุนูููุงุช ุงููุณุชุฎุฏู
        function updateUserInfo() {
            const userBadge = document.getElementById('userBadge');
            if (userBadge) {
                userBadge.textContent = '๐ค ุถูู';
            }
        }

        // ุฅุธูุงุฑ ุงูุฃุฎุจุงุฑ
        function showNews() {
            const attachmentsMenu = document.getElementById('attachmentsMenu');
            attachmentsMenu.style.display = 'none';
            window.clainai.getNews();
        }

        // ุฑูุน ุงููููุงุช
        function uploadFiles() {
            const attachmentsMenu = document.getElementById('attachmentsMenu');
            attachmentsMenu.style.display = 'none';
            document.getElementById('fileInput').click();
        }

        // ุฑูุน ุงูุตูุฑ
        function uploadImages() {
            const attachmentsMenu = document.getElementById('attachmentsMenu');
            attachmentsMenu.style.display = 'none';
            document.getElementById('imageInput').click();
        }

        // ูุนุงูุฌุฉ ุงุฎุชูุงุฑ ุงููููุงุช
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                window.clainai.handleFileUpload(e);
            }
        });

        // ูุนุงูุฌุฉ ุงุฎุชูุงุฑ ุงูุตูุฑ
        document.getElementById('imageInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const fileNames = Array.from(e.target.files).map(file => file.name).join(', ');
                window.clainai.addMessageToUI('user', `๐ผ๏ธ ุฑูุน ุตูุฑ: ${fileNames}`);
                
                // ูุญุงูุงุฉ ุงูุฑุฏ
                setTimeout(() => {
                    window.clainai.addMessageToUI('assistant',
                        `โ **ุชู ุฑูุน ${e.target.files.length} ุตูุฑุฉ ุจูุฌุงุญ!**\n\n` +
                        `๐ผ๏ธ **ุงูุตูุฑ:** ${fileNames}\n\n` +
                        `๐ก *ูููููู ุงูุขู ูุณุงุนุฏุชู ูู ุชุญููู ูุฐู ุงูุตูุฑ!*`
                    );
                }, 1000);
            }
        });

        // ููุฒุฉ ูุณุฎ ุงูุฑุณุงุฆู
        function addCopyFeature(element) {
            if (!element) return;

            element.style.cursor = 'pointer';
            element.title = 'ุงููุฑ ูููุณุฎ';

            element.addEventListener('click', async function() {
                const textToCopy = this.textContent || this.innerText;

                try {
                    await navigator.clipboard.writeText(textToCopy);

                    // ุฅุธูุงุฑ ูุคุดุฑ ุงููุณุฎ
                    const copyIndicator = document.createElement('div');
                    copyIndicator.className = 'copy-indicator';
                    copyIndicator.textContent = 'ุชู ุงููุณุฎ!';
                    this.appendChild(copyIndicator);

                    setTimeout(() => {
                        if (copyIndicator.parentElement === this) {
                            this.removeChild(copyIndicator);
                        }
                    }, 2000);

                } catch (err) {
                    console.error('ูุดู ูู ูุณุฎ ุงููุต: ', err);
                }
            });
        }

        // ุชุทุจูู ููุฒุฉ ุงููุณุฎ ุนูู ุงูุฑุณุงุฆู ุงูููุฌูุฏุฉ
        setTimeout(() => {
            document.querySelectorAll('.message-bubble').forEach(addCopyFeature);
        }, 1000);
    </script>
</body>
</html>
